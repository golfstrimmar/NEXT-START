generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Message {
  id                  Int                 @id @default(autoincrement())
  text                String
  author              String
  authorID            Int
  createdAt           DateTime            @default(now())
  UserMessageReaction UserMessageReaction[]
  comments            Comment[]           @relation
  commentReactions    CommentReaction[]   @relation
  @@index([authorID, createdAt])
}

model User {
  id                  Int                 @id @default(autoincrement())
  userName            String              @unique
  email               String              @unique
  password            String?
  googleId            String?             @unique
  avatarUrl           String?
  createdAt           DateTime            @default(now())
  UserMessageReaction UserMessageReaction[]
  comments            Comment[]           @relation
  commentReactions    CommentReaction[]   @relation
  @@index([email, userName])
}

model UserMessageReaction {
  id                  Int                 @id @default(autoincrement())
  userId              Int
  userName            String
  messageId           Int
  reaction            String
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  message             Message             @relation(fields: [messageId], references: [id], onDelete: Cascade)
  @@unique([userId, messageId])
  @@index([userId, messageId])
}

model Comment {
  id                  Int                 @id @default(autoincrement())
  text                String
  userId              Int
  userName            String
  messageId           Int
  createdAt           DateTime            @default(now())
  likes               Int                 @default(0)
  dislikes            Int                 @default(0)
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  message             Message             @relation(fields: [messageId], references: [id], onDelete: Cascade)
  commentReactions    CommentReaction[]   @relation
  @@index([userId, messageId, createdAt])
}

model CommentReaction {
  id                  Int                 @id @default(autoincrement())
  userId              Int
  userName            String
  commentId           Int
  messageId           Int
  reaction            String
  createdAt           DateTime            @default(now())
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  comment             Comment             @relation(fields: [commentId], references: [id], onDelete: Cascade)
  message             Message             @relation(fields: [messageId], references: [id], onDelete: Cascade)
  @@unique([userId, commentId])
  @@index([userId, commentId])
}

